BROKER SCHEMA COMMON



CREATE PROCEDURE processUSonUS(IN ISOMG REFERENCE, OUT DEBITACC CHARACTER,OUT CREDITACC CHARACTER, OUT CREDITCODE CHARACTER, OUT DEBITCODE CHARACTER) BEGIN
	
			DECLARE PROCESSINGCODE, TerminalID, TerminalSource CHARACTER;
			SET  PROCESSINGCODE= CAST(LEFT(ISOMSG.ProcessingCode_003,2)AS CHAR);  
			
			SET TerminalID = 	THE(SELECT ITEM T.TERMINALID FROM Database.ZBDB_ESB.DB2INST1.TERMINAL AS T WHERE T.TERMINALID =ISOMSG.CardAcceptorTerminalIdentification_041);
			SET TerminalSource = THE(SELECT ITEM T.SOURCE FROM Database.ZBDB_ESB.DB2INST1.TERMINAL AS T WHERE T.TERMINALID =ISOMSG.CardAcceptorTerminalIdentification_041);
		
			
		 	SET DEBITCODE = THE(SELECT ITEM T.DEBITCODE FROM Database.ZBDB_ESB.DB2INST1.TRANSACTIONCODE AS T WHERE T.PROCESSINGCODE = PROCESSINGCODE AND T.SOURCE = Environment.BET.TerminalSource );-- WILL NEED TO USE 6 CHARS
			SET CREDITCODE = THE(SELECT ITEM T.CREDITCODE FROM Database.ZBDB_ESB.DB2INST1.TRANSACTIONCODE AS T WHERE T.PROCESSINGCODE = PROCESSINGCODE AND T.SOURCE = Environment.BET.TerminalSource);	

END;	